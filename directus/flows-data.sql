--
-- PostgreSQL database dump
--

-- Dumped from database version 15.13 (Debian 15.13-1.pgdg120+1)
-- Dumped by pg_dump version 15.13 (Debian 15.13-1.pgdg120+1)

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- Data for Name: directus_flows; Type: TABLE DATA; Schema: public; Owner: directus_user
--

COPY public.directus_flows (id, name, icon, color, description, status, trigger, accountability, options, operation, date_created, user_created) FROM stdin;
92d0c53e-d9fb-43d8-894f-cff1c508e498	Generate description for course	robot	\N	\N	active	manual	all	{"collections":["lms_courses"],"requireConfirmation":true,"fields":[{"field":"prompt","name":"Prompt","meta":{}}],"confirmationDescription":"Give it a context"}	a743048e-122f-401c-bed2-edda701bafb2	2025-06-30 14:26:01.342+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
0d2da200-cb38-4f3c-8181-80b03e4ecf20	Generate Content for lesson	robot	\N	\N	active	manual	all	{"collections":["lms_lessons"],"location":"item","requireConfirmation":true,"confirmationDescription":"Pass a prompt to AI here.","fields":[{"field":"user_prompt","name":"Prompt","type":"text","meta":{"interface":"input-multiline"}}]}	f32ff53e-0281-434d-8932-91c457aed6f1	2025-06-28 16:23:10.103+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
cef55b59-2cdf-4bea-980a-69659bb196b1	Generate lesson plan	bolt	\N	\N	active	manual	all	{"collections":["lms_lessons"],"location":"item"}	ac02b844-ee08-4916-b674-d7b114b301e1	2025-09-04 12:55:31.983+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
4180553e-1926-4cd3-b579-3c4f9f5832dc	Create lessons	create_new_folder	\N	\N	active	operation	all	{"return":"$all"}	d82c3a5d-f420-44a4-9ef9-68ba2d1e9556	2025-06-30 14:48:40.251+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
dc81ff24-171f-4531-a96f-9391f6df2224	Create assignements	create_new_folder	\N	\N	active	operation	all	{"return":"$all"}	1abe2510-7847-43e7-ab30-fb62cf4f4706	2025-07-02 15:50:39.608+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
34bcc122-facb-4894-96f3-2c1bf9b13027	create modules	create_new_folder	\N	\N	active	operation	all	{"return":"$all"}	35b826e8-cfbf-41ce-b7cf-2d84d160f1c9	2025-06-30 14:40:45.473+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
d3c0c6d8-17f5-4098-8d55-ec00964eeff4	Generate assignments	robot	\N	\N	active	manual	all	{"collections":["lms_lessons"],"requireConfirmation":true,"location":"item","confirmationDescription":"Give some indications for the assignement","fields":[{"field":"prompt","name":"Prompt","type":"text","meta":{"interface":"input-multiline"}}]}	7f362df1-59f8-4cc7-a363-f2a635204426	2025-07-02 15:46:59.384+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
de566c70-b9fd-44d9-81e6-e3d0aa6e32d0	Update Lesson Plan PDF	bolt	\N	\N	active	event	all	{"type":"action","scope":["items.update"],"collections":["Learning_paths"]}	eb3dc016-9027-4e03-b152-8502520b6a7b	2025-12-08 11:59:57.328+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
7c45f860-39d1-4489-b6fe-76ca57cfeb4a	PDF Processing Flow	bolt	\N	\N	inactive	event	all	{"type":"action","scope":["items.update"],"collections":["lms_courses"]}	0df88152-f48c-4429-a647-741366a8bedc	2025-09-16 14:41:06.811+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
bce98901-26af-4f89-8c46-979742700406	PDF LOOP	bolt	\N	\N	active	operation	all	{"return":"$all"}	e470f88a-d3e1-4cad-a318-f186f46693f5	2025-09-29 19:21:02.088+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
cd5a46f5-91ac-4d3f-802f-0df1c84e902e	Generate lessons for module	robot	\N	\N	active	manual	all	{"collections":["lms_modules"],"requireConfirmation":true,"confirmationDescription":"Pass a prompt to AI here.","fields":[{"field":"context","name":"Prompt","meta":{}}]}	8ac54dde-b1dd-4e6e-9581-3e2843fcd23f	2025-06-30 14:45:45.68+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
b45e5291-3f3d-44b9-bb0f-9a4a7572f56c	Generate_simulation	draw_collage	\N	\N	active	manual	all	{"collections":["lms_lessons"],"location":"item","requireConfirmation":true,"confirmationDescription":"Essayer de donner le plus de details possible sur la simulation que vous voulez","fields":[{"field":"prompt","name":"Prompt","meta":{}}]}	8f02b5bf-047f-4f75-8b7d-b81a955da6ae	2025-07-02 11:05:03.95+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
e61e1ed2-7d47-4468-b7be-8314290bb2a0	Generate modules for course	robot	\N	\N	active	manual	all	{"collections":["lms_courses"],"requireConfirmation":true,"fields":[{"field":"context","name":"Context","meta":{}}]}	3b30220b-4e33-4d24-ab48-9ad4f095d950	2025-06-30 14:37:26.529+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
\.


--
-- Data for Name: directus_operations; Type: TABLE DATA; Schema: public; Owner: directus_user
--

COPY public.directus_operations (id, name, key, type, position_x, position_y, options, resolve, reject, flow, date_created, user_created) FROM stdin;
07f00149-16ad-4bcb-b4d2-1b6670ae1bec	Update Data	item_update_2qx0d	item-update	106	3	{"permissions":"$full","emitEvents":true,"collection":"lms_lessons","key":["{{lesson_data.id}}"],"payload":{"Lesson_Plan":"{{$last}}"}}	\N	\N	cef55b59-2cdf-4bea-980a-69659bb196b1	2025-09-09 15:13:35.912+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
9843db95-0513-4c05-9e90-4df12705337e	Create lesson plan	create_lesson_plan	item-create	87	1	{"permissions":"$full","emitEvents":false,"collection":"Learning_paths","payload":{"Learning_path":"{{request_at8r0.data}}","lesson":"{{lesson_data.id}}","url":"https://lms.tecktal.ai{{$last.data.url}}"}}	07f00149-16ad-4bcb-b4d2-1b6670ae1bec	\N	cef55b59-2cdf-4bea-980a-69659bb196b1	2025-09-09 14:43:42.973+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
f2559646-4599-45ed-81e6-5401b8fdb4e5	Webhook / Request URL	request_lj7gi	request	94	22	{"method":"POST","url":"http://pdf-service:8001/convert-to-pdf","headers":[{"header":"Content-Type","value":"application/json"}],"body":"\\n{{$last}}"}	9843db95-0513-4c05-9e90-4df12705337e	\N	cef55b59-2cdf-4bea-980a-69659bb196b1	2025-12-01 13:16:05.04+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
35b826e8-cfbf-41ce-b7cf-2d84d160f1c9	Create Data	item_create_0j18f	item-create	19	1	{"permissions":"$trigger","emitEvents":false,"collection":"lms_modules","payload":{"title":"{{ $trigger.title }}","description":"{{ $trigger.description }}","course":"{{ $trigger.course }}"}}	\N	\N	34bcc122-facb-4894-96f3-2c1bf9b13027	2025-06-30 14:41:18.161+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
89a8751c-c636-4c44-bce8-27ad34866602	Read Data	item_read_ncdal	item-read	41	22	{"permissions":"$trigger","emitEvents":false,"collection":"lms_courses","query":{"filter":{"id":{"_eq":"{{lesson_data.module.course}}"}},"fields":["id","title","description"]}}	3188e63e-3468-49bb-9c49-c86954f43e79	\N	b45e5291-3f3d-44b9-bb0f-9a4a7572f56c	2025-10-19 13:38:35.607+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
83f30423-4812-426e-b698-2796022306be	Read Data	get_real_user	item-read	23	21	{"permissions":"$full","emitEvents":false,"collection":"directus_users","query":{"id":{"_eq":"{{get_session_user[0].user}}"}}}	9749bbef-befe-4b86-88ee-72acf8f5e1b8	\N	cd5a46f5-91ac-4d3f-802f-0df1c84e902e	2025-07-25 14:34:33.252+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
d82c3a5d-f420-44a4-9ef9-68ba2d1e9556	Create Data	item_create_1dxzv	item-create	19	1	{"permissions":"$trigger","emitEvents":false,"collection":"lms_lessons","payload":{"title":"{{ $trigger.title }}","slug":"{{ $trigger.slug }}","module":"{{ $trigger.module }}"}}	\N	\N	4180553e-1926-4cd3-b579-3c4f9f5832dc	2025-06-30 14:49:16.812+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
fe0737ee-8a7d-48f9-84e2-d572de7aff85	Run Script	exec_m2j27	exec	66	35	{"code":"module.exports = async function(data) {\\n  const url = data.$last.url;\\n  \\n  if (!url) {\\n    throw new Error('No URL provided');\\n  }\\n\\n  const match = url.match(/\\\\/assets\\\\/([a-f0-9\\\\-]+)/i);\\n  \\n  if (!match || !match[1]) {\\n    throw new Error('Could not extract file_id from URL: ' + url);\\n  }\\n\\n  // Create the properly escaped JSON body\\n  const jsonBody = JSON.stringify({\\n    file_id: match[1],\\n    html: data.$last.html\\n  });\\n\\n  return jsonBody;\\n}"}	f3126e52-2f4c-4d5d-a461-847d75dc2207	\N	de566c70-b9fd-44d9-81e6-e3d0aa6e32d0	2025-12-08 12:50:31.734+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
03c4b3fa-b958-40a9-8477-b612fc9e513f	Update Data	item_update_4i7im	item-update	60	1	{"permissions":"$full","emitEvents":true,"collection":"lms_courses","key":["{{item_read_ic3cb.id}}"],"payload":{"description":"{{request_qwumd.data.course.short_description}}","description_long":"{{request_qwumd.data.course.long_description}}"}}	\N	\N	92d0c53e-d9fb-43d8-894f-cff1c508e498	2025-06-30 14:30:33.832+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
af9089b5-693f-4e5a-b2d3-1038ac4ee16c	Update Data	update_data	item-update	93	1	{"permissions":"$full","emitEvents":true,"collection":"lms_lessons","key":["{{lesson_data.id}}"],"payload":{"content":"{{$last.data}}"}}	\N	\N	0d2da200-cb38-4f3c-8181-80b03e4ecf20	2025-06-28 16:27:06.884+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
f82fb62f-04b8-4319-a910-284eae002bd0	Trigger Flow	trigger_flow	trigger	74	1	{"iterationMode":"parallel","flow":"34bcc122-facb-4894-96f3-2c1bf9b13027","payload":"{{ exec_nwiqn.parsedModules }}"}	\N	\N	e61e1ed2-7d47-4468-b7be-8314290bb2a0	2025-06-30 14:42:07.461+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
94569364-fdc6-42de-aa85-424ca04e03d3	Trigger Flow	trigger_ho44b	trigger	58	1	{"iterationMode":"serial","flow":"bce98901-26af-4f89-8c46-979742700406","payload":"{{exec_mckqi}}"}	\N	\N	7c45f860-39d1-4489-b6fe-76ca57cfeb4a	2025-09-29 19:27:32.9+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
1cc7ceef-f613-4b49-94a8-0a1bb629f50b	Run Script	exec_nwiqn	exec	56	1	{"code":"module.exports = async function (data) {\\n\\treturn {\\n\\t\\tparsedModules: JSON.parse(data.$last.data)\\n\\t};\\n};\\n"}	f82fb62f-04b8-4319-a910-284eae002bd0	\N	e61e1ed2-7d47-4468-b7be-8314290bb2a0	2025-06-30 14:40:19.476+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
59bcf5e2-424a-4063-9a0d-71adefc35fe4	Read Data	courses_data	item-read	20	1	{"permissions":"$full","emitEvents":false,"collection":"lms_courses","key":["{{$trigger.body.keys[0]}}"]}	a93584d0-cf4a-46e9-b211-4e2af0841456	\N	e61e1ed2-7d47-4468-b7be-8314290bb2a0	2025-06-30 14:40:19.549+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
78b5d766-18aa-4da2-9eae-52958e1411d4	Read Data	module_lessons	item-read	67	18	{"permissions":"$trigger","emitEvents":false,"collection":"lms_lessons","query":{"filter":{"module":{"_eq":"{{lesson_data.module.id}}"}},"fields":["id","title","sort"],"sort":["sort"]}}	6d0cb882-8280-4b9c-8db9-2dcf6c494a78	\N	0d2da200-cb38-4f3c-8181-80b03e4ecf20	2025-09-18 11:49:03.344+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
6261f3f8-fb22-4139-9d6f-8a1721d410b3	Read Data	item_read_uogkq	item-read	22	16	{"permissions":"$full","emitEvents":false,"collection":"Learning_paths","key":["{{$trigger.keys[0]}}"],"query":{"fields":["id","url","Learning_path"]}}	9d446678-10bf-4e67-bd13-1cef5a5acbef	\N	de566c70-b9fd-44d9-81e6-e3d0aa6e32d0	2025-12-08 12:29:35.027+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
caeed59a-c865-4524-aa0d-65b646279826	Read Data	item_read_ic3cb	item-read	21	1	{"permissions":"$full","emitEvents":false,"collection":"lms_courses","key":["{{$trigger.body.keys[0]}}"]}	0a362c21-f681-4ed0-afcb-cfc21753cfeb	\N	92d0c53e-d9fb-43d8-894f-cff1c508e498	2025-06-30 14:30:33.874+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
ae9bbba1-3f51-4db2-aba6-9dac41d28a84	Read Data	other_modules	item-read	57	1	{"permissions":"$trigger","emitEvents":false,"collection":"lms_modules","query":{"filter":{"course":{"_eq":"{{course_data[0].id}}"},"id":{"_neq":"{{lesson_data.module.id}}"}},"fields":["title","description"],"sort":["sort"]}}	78b5d766-18aa-4da2-9eae-52958e1411d4	\N	0d2da200-cb38-4f3c-8181-80b03e4ecf20	2025-09-18 10:26:00.899+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
322bc2d1-5eb7-4f90-a873-1f09f1f5c49a	Run Script	exec_omgub	exec	61	14	{"code":"module.exports = async function (data) {\\n\\treturn {\\n\\t\\tcourse: JSON.parse(data.course)\\n\\t};\\n};\\n"}	\N	\N	92d0c53e-d9fb-43d8-894f-cff1c508e498	2025-06-30 14:30:33.849+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
deb5df6c-4655-43a3-8261-dad9e5d773fe	Lesson Data	lesson_data	item-read	20	1	{"permissions":"$trigger","emitEvents":false,"collection":"lms_lessons","key":["{{$trigger.body.keys[0]}}"],"query":{"fields":["id","title","slug","content","module.*"]}}	05c22b57-2fde-4710-b26e-34f0874876cc	\N	cef55b59-2cdf-4bea-980a-69659bb196b1	2025-09-09 14:38:28.458+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
e7c210e7-5972-4f70-a22f-6a8f67374193	Run Script	exec_wlknm	exec	43	22	{"code":"module.exports = async function (data) {\\n  // Get session data (it's an array)\\n  const sessions = data.get_session_user || [];\\n  \\n  // Find the session that matches our current session token\\n  const currentSessionToken = data.$accountability?.session;\\n  const currentSession = sessions.find(session => session.token === currentSessionToken);\\n  \\n  // Get user ID from the matching session\\n  const userId = currentSession?.user;\\n  \\n  // Now get the user data\\n  const allUsers = data.get_real_user || [];\\n  const realUser = allUsers.find(user => user.id === userId) || allUsers[0];\\n  \\n  const userInfo = {\\n \\tlanguage: realUser?.language || \\"en-US\\",\\n    user_id: realUser?.id || null,\\n    name: realUser?.first_name || null,\\n    email: realUser?.email || null,\\n    debug_session_token: currentSessionToken,\\n    debug_found_user_id: userId\\n  };\\n  \\n  return {\\n    userInfo\\n  };\\n};"}	6dad23dd-e95c-4b75-9e33-ccd6b3b51047	\N	d3c0c6d8-17f5-4098-8d55-ec00964eeff4	2025-07-25 14:39:30.745+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
9c9133ca-a0e7-45f6-b4b3-59ad59674476	Update Data	item_update_auugd	item-update	78	15	{"permissions":"$full","emitEvents":true,"collection":"Learning_paths","payload":{"url":"https://lms.tecktal.ai{{$last.data.url}}"},"key":["{{$trigger.keys[0]}}"]}	\N	\N	de566c70-b9fd-44d9-81e6-e3d0aa6e32d0	2025-12-08 14:26:57.857+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
6d0cb882-8280-4b9c-8db9-2dcf6c494a78	Webhook / Request URL	request_3fmgp	request	76	1	{"method":"POST","url":"http://rag-service:8000/generate-lesson-content","headers":[{"header":"Content-Type","value":"application/json"}],"body":"{\\n  \\"lesson_title\\": \\"{{lesson_data.title}}\\",\\n  \\"lesson_id\\": \\"{{lesson_data.id}}\\",\\n  \\"module_title\\": \\"{{lesson_data.module.title}}\\",\\n  \\"module_description\\": \\"{{lesson_data.module.description}}\\",\\n  \\"course_title\\": \\"{{course_data[0].title}}\\",\\n  \\"course_description\\": \\"{{course_data[0].description}}\\",\\n  \\"other_modules\\": {{other_modules}},\\n  \\"module_lessons\\": {{module_lessons}},\\n  \\"course_id\\": \\"{{course_data[0].id}}\\",\\n  \\"context\\": \\"{{$trigger.body.context || 'Generate comprehensive and detailed lesson content'}}\\",\\n  \\"language\\": \\"{{$trigger.body.language || 'en-US'}}\\"\\n}"}	af9089b5-693f-4e5a-b2d3-1038ac4ee16c	\N	0d2da200-cb38-4f3c-8181-80b03e4ecf20	2025-09-18 10:31:01.5+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
45cba55e-cd66-4243-909d-b817ccc7b5a9	Read Data	course_data	item-read	39	1	{"permissions":"$full","emitEvents":false,"collection":"lms_courses","query":{"filter":{"id":{"_eq":"{{lesson_data.module.course}}"}},"fields":["id","title","description"]}}	ae9bbba1-3f51-4db2-aba6-9dac41d28a84	\N	0d2da200-cb38-4f3c-8181-80b03e4ecf20	2025-09-18 10:24:46.464+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
edb63fdc-01b3-4cf1-a501-43db8d88e3b4	Run Script	exec_vfiq7	exec	78	1	{"code":"module.exports = async function (data) {\\n\\treturn {\\n\\t\\tparsedModules: JSON.parse(data.$last.data)\\n\\t};\\n};\\n\\n\\n"}	d3d954fa-47d9-4439-99e9-62b88f40c4e1	\N	b45e5291-3f3d-44b9-bb0f-9a4a7572f56c	2025-07-02 11:08:32.938+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
b6f5f592-e847-4fb1-a74a-435718bfae3a	Trigger Flow	trigger_flow	trigger	73	1	{"iterationMode":"parallel","flow":"4180553e-1926-4cd3-b579-3c4f9f5832dc","payload":"{{ exec_o6vim.parsedLessons }}"}	\N	\N	cd5a46f5-91ac-4d3f-802f-0df1c84e902e	2025-06-30 14:49:54.899+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
3188e63e-3468-49bb-9c49-c86954f43e79	Run Script	exec_qpdq6	exec	59	1	{"code":"module.exports = async function (data) {\\n  const rawContent = data.lesson_data?.content || \\"\\";\\n  const id = data.lesson_data?.id;\\n  const course_id = data.item_read_ncdal[0]?.id\\n  \\n  const plainText = rawContent\\n    .replace(/<[^>]*>/g, \\"\\")\\n    .replace(/\\\\s+/g, \\" \\")\\n    .trim();\\n    \\n  const safeText = JSON.stringify(plainText);\\n  \\n  // Get session from trigger headers\\n  const sessionCookie = data.$trigger?.headers?.cookie;\\n  const sessionId = data.$accountability?.session;\\n  \\n  // You can use the session to identify the real user\\n  // The session ID should correspond to the actual logged-in admin\\n  \\n  let userInfo = {\\n    language: null,\\n    session_id: sessionId,\\n    // For now, you might need to hardcode or use a lookup table\\n    // based on session or IP to identify the real admin user\\n  };\\n  \\n  return {\\n    plainText: safeText.slice(1, -1),\\n    id,\\n    course_id,\\n    userInfo,\\n    debug_session: sessionId,\\n    debug_ip: data.$accountability?.ip\\n  };\\n};"}	68624416-9766-4243-aa46-0dde2a81aa00	\N	b45e5291-3f3d-44b9-bb0f-9a4a7572f56c	2025-07-02 11:21:41.865+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
c4febee4-995d-4e63-9d3c-13519134d315	Read Data	item_read_4e7a1	item-read	21	2	{"permissions":"$full","emitEvents":false,"collection":"directus_files","query":{"filter":{"id":{"_in":"{{exec_vnuzf.fileIds}}"}}}}	822e143e-7949-4d09-9e83-1381b0737804	\N	7c45f860-39d1-4489-b6fe-76ca57cfeb4a	2025-09-17 12:35:05.79+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
0df88152-f48c-4429-a647-741366a8bedc	Run Script	exec_vnuzf	exec	19	20	{"code":"module.exports = async function(data) {\\n  const creates = data.$trigger.payload.curriculum_file?.create || [];\\n  const fileIds = creates.map(item => item.directus_files_id.id);\\n  \\n  return { fileIds };\\n};"}	c4febee4-995d-4e63-9d3c-13519134d315	\N	7c45f860-39d1-4489-b6fe-76ca57cfeb4a	2025-09-29 19:36:18.623+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
f575d551-15f5-4ca6-bd31-585101d6530b	Run Script	exec_o6vim	exec	55	1	{"code":"module.exports = async function (data) {\\n    return {\\n        parsedLessons: JSON.parse(data.$last.data)\\n    };\\n};"}	b6f5f592-e847-4fb1-a74a-435718bfae3a	\N	cd5a46f5-91ac-4d3f-802f-0df1c84e902e	2025-06-30 14:48:16.737+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
acd4408d-c579-4ae6-b5a2-52df24948411	Get Lesson Data	lesson_data	item-read	40	1	{"permissions":"$full","emitEvents":false,"collection":"lms_lessons","key":["{{$trigger.body.keys[0]}}"],"query":{"fields":["id","title","slug","content","module.*"]}}	89a8751c-c636-4c44-bce8-27ad34866602	\N	b45e5291-3f3d-44b9-bb0f-9a4a7572f56c	2025-07-02 11:08:32.985+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
8362c67b-f6a6-4e06-b6d1-fcc1ecd393a5	Read Data	get_real_user	item-read	23	21	{"permissions":"$full","emitEvents":false,"collection":"directus_users","query":{"id":{"_eq":"{{get_session_user[0].user}}"}}}	9e0fb3e8-7154-4a80-8217-073029eb3c14	\N	e61e1ed2-7d47-4468-b7be-8314290bb2a0	2025-07-25 14:21:55.927+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
3b30220b-4e33-4d24-ab48-9ad4f095d950	Read Data	get_session_user	item-read	3	21	{"permissions":"$full","emitEvents":false,"collection":"directus_sessions","query":{"token":{"_eq":"{{$accountability.session}}"}},"key":[]}	8362c67b-f6a6-4e06-b6d1-fcc1ecd393a5	\N	e61e1ed2-7d47-4468-b7be-8314290bb2a0	2025-07-25 14:21:50.512+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
a743048e-122f-401c-bed2-edda701bafb2	Read Data	get_session_user	item-read	3	21	{"permissions":"$full","emitEvents":false,"collection":"directus_sessions","query":{"token":{"_eq":"{{$accountability.session}}"}},"key":[]}	a6fdba94-cfae-4ac4-95f3-fae1151e0224	\N	92d0c53e-d9fb-43d8-894f-cff1c508e498	2025-07-25 14:38:18.652+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
68624416-9766-4243-aa46-0dde2a81aa00	Webhook / Request URL	openai_request	request	62	20	{"method":"POST","url":"http://rag-service:8000/generate-simulation","headers":[{"header":"Content-Type","value":"application/json"}],"body":"{\\n  \\"lesson_id\\": \\"{{exec_qpdq6.id}}\\",\\n  \\"lesson_content\\": \\"{{exec_qpdq6.plainText}}\\",\\n  \\"simulation_prompt\\": \\"{{$trigger.body.prompt}}\\",\\n  \\"course_id\\": \\"{{exec_qpdq6.course_id}}\\",\\n  \\"language\\": \\"{{exec_wlknm.userInfo.language}}\\"\\n}"}	edb63fdc-01b3-4cf1-a501-43db8d88e3b4	\N	b45e5291-3f3d-44b9-bb0f-9a4a7572f56c	2025-07-02 11:08:32.955+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
e470f88a-d3e1-4cad-a318-f186f46693f5	Webhook / Request URL	request_7ov3p	request	19	1	{"method":"POST","url":"http://rag-service:8000/process-document","headers":[{"header":"Content-Type","value":"application/json"}],"body":"{\\n  \\"file_id\\": \\"{{$trigger.id}}\\",\\n  \\"filename\\": \\"{{$trigger.filename_download}}\\",\\n  \\"file_path\\": \\"{{$trigger.filename_disk}}\\",\\n  \\"course_id\\": \\"{{$trigger.course_id}}\\"\\n}"}	\N	\N	bce98901-26af-4f89-8c46-979742700406	2025-09-29 19:44:04.495+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
1a311a04-c013-46a6-b385-843b1058e2b0	Run Script	exec_wlknm	exec	22	22	{"code":"module.exports = async function (data) {\\n  // Get session data (it's an array)\\n  const sessions = data.get_session_user || [];\\n  \\n  // Find the session that matches our current session token\\n  const currentSessionToken = data.$accountability?.session;\\n  const currentSession = sessions.find(session => session.token === currentSessionToken);\\n  \\n  // Get user ID from the matching session\\n  const userId = currentSession?.user;\\n  \\n  // Now get the user data\\n  const allUsers = data.get_real_user || [];\\n  const realUser = allUsers.find(user => user.id === userId) || allUsers[0];\\n  \\n  const userInfo = {\\n \\tlanguage: realUser?.language || \\"en-US\\",\\n    user_id: realUser?.id || null,\\n    name: realUser?.first_name || null,\\n    email: realUser?.email || null,\\n    debug_session_token: currentSessionToken,\\n    debug_found_user_id: userId\\n  };\\n  \\n  return {\\n    userInfo\\n  };\\n};"}	acd4408d-c579-4ae6-b5a2-52df24948411	\N	b45e5291-3f3d-44b9-bb0f-9a4a7572f56c	2025-07-24 10:24:16.455+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
9f26fb8b-7c5d-45f8-bebf-580c0b00d294	Run Script	exec_wlknm	exec	43	22	{"code":"module.exports = async function (data) {\\n  // Get session data (it's an array)\\n  const sessions = data.get_session_user || [];\\n  \\n  // Find the session that matches our current session token\\n  const currentSessionToken = data.$accountability?.session;\\n  const currentSession = sessions.find(session => session.token === currentSessionToken);\\n  \\n  // Get user ID from the matching session\\n  const userId = currentSession?.user;\\n  \\n  // Now get the user data\\n  const allUsers = data.get_real_user || [];\\n  const realUser = allUsers.find(user => user.id === userId) || allUsers[0];\\n  \\n  const userInfo = {\\n \\tlanguage: realUser?.language || \\"en-US\\",\\n    user_id: realUser?.id || null,\\n    name: realUser?.first_name || null,\\n    email: realUser?.email || null,\\n    debug_session_token: currentSessionToken,\\n    debug_found_user_id: userId\\n  };\\n  \\n  return {\\n    userInfo\\n  };\\n};"}	caeed59a-c865-4524-aa0d-65b646279826	\N	92d0c53e-d9fb-43d8-894f-cff1c508e498	2025-07-25 14:38:24.608+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
f3126e52-2f4c-4d5d-a461-847d75dc2207	Webhook / Request URL	request_ud6pd	request	67	1	{"method":"POST","url":"http://pdf-service:8001/update-pdf","headers":[{"header":"Content-Type","value":"application/json"}],"body":"{{exec_gyp4i}}"}	9c9133ca-a0e7-45f6-b4b3-59ad59674476	\N	de566c70-b9fd-44d9-81e6-e3d0aa6e32d0	2025-12-08 12:02:09.91+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
eb3dc016-9027-4e03-b152-8502520b6a7b	Condition	condition_zuxqy	condition	14	34	{"filter":{"$trigger":{"payload":{"Learning_path":{"_nnull":true}}}}}	6261f3f8-fb22-4139-9d6f-8a1721d410b3	\N	de566c70-b9fd-44d9-81e6-e3d0aa6e32d0	2025-12-08 14:40:15.245+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
ac02b844-ee08-4916-b674-d7b114b301e1	Read Data	get_session_user	item-read	4	21	{"permissions":"$full","emitEvents":false,"collection":"directus_sessions","query":{"token":{"_eq":"{{$accountability.session}}"}},"key":[]}	5fe3e900-598e-4cab-b59d-c038cf59b315	\N	cef55b59-2cdf-4bea-980a-69659bb196b1	2025-09-09 14:56:24.279+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
9dbf2043-3754-4c44-b4ad-e41218e89072	openai request	openai_request	request	37	1	{"method":"POST","url":"http://rag-service:8000/generate-lessons","headers":[{"header":"Content-Type","value":"application/json"}],"body":"{\\n  \\"module_title\\": \\"{{modules_data.title}}\\",\\n  \\"module_id\\": \\"{{modules_data.id}}\\",\\n  \\"course_id\\": \\"{{modules_data.course}}\\",\\n  \\"context\\": \\"{{$trigger.body.context}}\\",\\n  \\"language\\": \\"{{exec_wlknm.userInfo.language}}\\"\\n}"}	f575d551-15f5-4ca6-bd31-585101d6530b	\N	cd5a46f5-91ac-4d3f-802f-0df1c84e902e	2025-06-30 14:48:16.746+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
8ac54dde-b1dd-4e6e-9581-3e2843fcd23f	Read Data	get_session_user	item-read	3	21	{"permissions":"$full","emitEvents":false,"collection":"directus_sessions","query":{"token":{"_eq":"{{$accountability.session}}"}},"key":[]}	83f30423-4812-426e-b698-2796022306be	\N	cd5a46f5-91ac-4d3f-802f-0df1c84e902e	2025-07-25 14:34:26.995+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
9d446678-10bf-4e67-bd13-1cef5a5acbef	Run Script	exec_gyp4i	exec	44	25	{"code":"module.exports = async function(data) {\\n    const url = data.$last.url;\\n    \\n    if (!url) {\\n        throw new Error('No URL provided');\\n    }\\n    \\n    const match = url.match(/\\\\/assets\\\\/([a-f0-9\\\\-]+)/i);\\n    \\n    if (!match || !match[1]) {\\n        throw new Error('Could not extract file_id from URL: ' + url);\\n    }\\n    \\n    return {\\n        file_id: match[1],\\n        url:data.$last.url,\\n        html: data.$last.Learning_path\\n    };\\n}"}	fe0737ee-8a7d-48f9-84e2-d572de7aff85	\N	de566c70-b9fd-44d9-81e6-e3d0aa6e32d0	2025-12-08 12:06:22.717+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
f32ff53e-0281-434d-8932-91c457aed6f1	Read Data	get_session_user	item-read	4	21	{"permissions":"$full","emitEvents":false,"collection":"directus_sessions","query":{"token":{"_eq":"{{$accountability.session}}"}},"key":[]}	b999d2a1-d929-497f-b277-c86d35c00741	\N	0d2da200-cb38-4f3c-8181-80b03e4ecf20	2025-07-25 14:36:58.01+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
822e143e-7949-4d09-9e83-1381b0737804	Run Script	exec_mckqi	exec	39	2	{"code":"module.exports = async function (data) {\\n  const files = data.item_read_4e7a1 || [];\\n  const courseId = data.$trigger.keys[0];\\n\\n  // add course_id to each file object\\n  const withCourseId = files.map(f => ({\\n    ...f,\\n    course_id: courseId\\n  }));\\n\\n  return withCourseId;\\n};\\n"}	94569364-fdc6-42de-aa85-424ca04e03d3	\N	7c45f860-39d1-4489-b6fe-76ca57cfeb4a	2025-09-29 20:24:29.26+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
5fe3e900-598e-4cab-b59d-c038cf59b315	Read Data	get_real_user	item-read	23	21	{"permissions":"$full","emitEvents":false,"collection":"directus_users","query":{"id":{"_eq":"{{get_session_user[0].user}}"}}}	591fb3b8-466d-462b-a8e5-cb3c664ec011	\N	cef55b59-2cdf-4bea-980a-69659bb196b1	2025-09-09 14:56:29.261+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
19b5b25d-f550-4fd1-94e7-6eaad614bbb7	Generate assignement with openAI	generate_assignement_with_open_ai	request	37	1	{"method":"POST","url":"https://api.openai.com/v1/chat/completions","headers":[{"header":"Authorization","value":"Bearer "},{"header":"Content-Type","value":"application/json"}],"body":"{\\n  \\"model\\": \\"gpt-4\\",\\n  \\"messages\\": [\\n    {\\n      \\"role\\": \\"system\\",\\n      \\"content\\": \\"You are a course content assistant.\\"\\n    },\\n    {\\n      \\"role\\": \\"user\\",\\n      \\"content\\": \\"Generate assignments titles, descriptions and instructions(instructions are in HTML format) for the lesson titled: \\\\\\"{{item_read_yh59r.title}}\\\\\\" and the content of the lesson being : . The assignment title should be clear and engaging, and the instruction should start with the goal of the assignment presented in an engaging way before giving the instructions in a very detailed way. Return only a JSON array where each item has a \\\\\\"title\\\\\\", \\\\\\"description\\\\\\", \\\\\\"instructions\\\\\\" and \\\\\\"lesson\\\\\\" field that has this value: {{item_read_yh59r.id}}. Do not include any extra commentary or explanation. Format the response strictly as JSON. here is some extra context you need to respect : {{$trigger.body.context}}.GENERATE THIS IN THIS LANGUAGE: {{exec_wlknm.userInfo.language}}. YOU MUST GENERATE ALL TEXT, LABELS, DESCRIPTIONS, AND EDUCATIONAL CONTENT IN THIS LANGUAGE.\\"\\n    }\\n  ],\\n  \\"temperature\\": 0.7\\n}"}	9f77cfa8-3f3e-4c1b-80ea-e780ed13d2e9	\N	d3c0c6d8-17f5-4098-8d55-ec00964eeff4	2025-07-02 15:50:00.919+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
d3d954fa-47d9-4439-99e9-62b88f40c4e1	Create Data	item_create_ig298	item-create	96	1	{"permissions":"$full","emitEvents":false,"collection":"lms_simulations","payload":{"title":"{{ exec_vfiq7.parsedModules.title }}","slug":"{{ exec_vfiq7.parsedModules.slug }}","description":"{{ exec_vfiq7.parsedModules.module }}","code":"{{exec_vfiq7.parsedModules.code}}","lesson":"{{exec_vfiq7.parsedModules.lesson}}"}}	\N	\N	b45e5291-3f3d-44b9-bb0f-9a4a7572f56c	2025-07-02 11:37:29.886+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
9e0fb3e8-7154-4a80-8217-073029eb3c14	Run Script	exec_wlknm	exec	43	22	{"code":"module.exports = async function (data) {\\n  // Get session data (it's an array)\\n  const sessions = data.get_session_user || [];\\n  \\n  // Find the session that matches our current session token\\n  const currentSessionToken = data.$accountability?.session;\\n  const currentSession = sessions.find(session => session.token === currentSessionToken);\\n  \\n  // Get user ID from the matching session\\n  const userId = currentSession?.user;\\n  \\n  // Now get the user data\\n  const allUsers = data.get_real_user || [];\\n  const realUser = allUsers.find(user => user.id === userId) || allUsers[0];\\n  \\n  const userInfo = {\\n \\tlanguage: realUser?.language || \\"en-US\\",\\n    user_id: realUser?.id || null,\\n    name: realUser?.first_name || null,\\n    email: realUser?.email || null,\\n    debug_session_token: currentSessionToken,\\n    debug_found_user_id: userId\\n  };\\n  \\n  return {\\n    userInfo\\n  };\\n};"}	59bcf5e2-424a-4063-9a0d-71adefc35fe4	\N	e61e1ed2-7d47-4468-b7be-8314290bb2a0	2025-07-25 14:21:59.163+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
a6fdba94-cfae-4ac4-95f3-fae1151e0224	Read Data	get_real_user	item-read	23	21	{"permissions":"$full","emitEvents":false,"collection":"directus_users","query":{"id":{"_eq":"{{get_session_user[0].user}}"}}}	9f26fb8b-7c5d-45f8-bebf-580c0b00d294	\N	92d0c53e-d9fb-43d8-894f-cff1c508e498	2025-07-25 14:38:21.241+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
04c8221a-f54e-4eac-bb8a-613ccd82350d	Lesson Data	lesson_data	item-read	21	1	{"permissions":"$full","emitEvents":false,"collection":"lms_lessons","key":["{{$trigger.body.keys[0]}}"],"query":{"fields":["id","title","slug","module.*"]}}	45cba55e-cd66-4243-909d-b817ccc7b5a9	\N	0d2da200-cb38-4f3c-8181-80b03e4ecf20	2025-06-28 16:27:06.907+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
b999d2a1-d929-497f-b277-c86d35c00741	Read Data	get_real_user	item-read	23	21	{"permissions":"$full","emitEvents":false,"collection":"directus_users","query":{"id":{"_eq":"{{get_session_user[0].user}}"}}}	8ee1a84e-e1a3-404f-a39e-1f3d371bcdda	\N	0d2da200-cb38-4f3c-8181-80b03e4ecf20	2025-07-25 14:37:00.85+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
a93584d0-cf4a-46e9-b211-4e2af0841456	Webhook / Request URL	request_dvjs1	request	38	1	{"method":"POST","url":"http://rag-service:8000/generate-modules","headers":[{"header":"Content-Type","value":"application/json"}],"body":"{\\n  \\"course_title\\": \\"{{courses_data.title}}\\",\\n  \\"course_id\\": \\"{{courses_data.id}}\\",\\n  \\"context\\": \\"{{$trigger.body.context}}\\",\\n  \\"language\\": \\"{{exec_wlknm.userInfo.language}}\\"\\n}"}	1cc7ceef-f613-4b49-94a8-0a1bb629f50b	\N	e61e1ed2-7d47-4468-b7be-8314290bb2a0	2025-06-30 14:40:19.505+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
08f03bbc-f01c-402d-b207-bda5e2eb4c5b	Webhook / Request URL	request_7ov3p	request	40	21	{"method":"POST","url":"http://rag-service:8000/process-document","headers":[{"header":"Content-Type","value":"application/json"}],"body":"{\\n  \\"file_id\\": \\"{{item_read_4e7a1[0].id}}\\",\\n  \\"filename\\": \\"{{item_read_4e7a1[0].filename_download}}\\",\\n  \\"file_path\\": \\"{{item_read_4e7a1[0].filename_disk}}\\",\\n  \\"course_id\\": \\"{{$trigger.keys[0]}}\\"\\n}"}	\N	\N	7c45f860-39d1-4489-b6fe-76ca57cfeb4a	2025-09-16 14:51:33.607+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
9f172d7d-4965-4b88-89b9-10afaf47170c	Condition	condition_g2sev	condition	60	18	{"filter":{"_and":[{"payload":{"type":{"_eq":"application/pdf"}}}]}}	\N	\N	7c45f860-39d1-4489-b6fe-76ca57cfeb4a	2025-09-16 14:47:46.649+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
0a362c21-f681-4ed0-afcb-cfc21753cfeb	Webhook / Request URL	request_qwumd	request	39	1	{"method":"POST","url":"http://rag-service:8000/generate-course-description","headers":[{"header":"Content-Type","value":"application/json"}],"body":"{\\n    \\"course_id\\": \\"{{item_read_ic3cb.id}}\\",\\n    \\"course_title\\": \\"{{item_read_ic3cb.title}}\\",\\n    \\"context\\": \\"{{$trigger.body.context || 'Generate comprehensive and detailed course description'}}\\",\\n    \\"language\\": \\"{{exec_wlknm.language || 'en-US'}}\\"\\n }"}	03c4b3fa-b958-40a9-8477-b612fc9e513f	\N	92d0c53e-d9fb-43d8-894f-cff1c508e498	2025-06-30 14:30:33.864+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
5d3d0481-ef44-44f1-81f7-cf6dedd5601f	Run Script	exec_p5j8p	exec	75	23	{"code":"module.exports = async function(data) {\\n    // Get the HTML content\\n    const htmlContent = data.$last.data;\\n    \\n    // Manually create a valid JSON string with proper escaping\\n    const jsonBody = JSON.stringify({\\n        html: htmlContent\\n    });\\n    \\n    // Return the JSON string (not an object)\\n    return jsonBody;\\n}"}	f2559646-4599-45ed-81e6-5401b8fdb4e5	\N	cef55b59-2cdf-4bea-980a-69659bb196b1	2025-12-01 14:04:10.845+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
7f362df1-59f8-4cc7-a363-f2a635204426	Read Data	get_session_user	item-read	3	21	{"permissions":"$full","emitEvents":false,"collection":"directus_sessions","query":{"token":{"_eq":"{{$accountability.session}}"}},"key":[]}	126456e9-186c-4303-870a-7c96875e90bd	\N	d3c0c6d8-17f5-4098-8d55-ec00964eeff4	2025-07-25 14:39:24.538+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
5bdbe60b-ab6f-447b-9c7c-a93bc6c6a8be	Run Script	exec_r7alu	exec	55	1	{"code":"module.exports = async function (data) {\\n  const rawContent = data.lesson_data?.content || \\"\\";\\n  const id = data.lesson_data?.id;\\n  const course_id = data.item_read_hyih4[0]?.id\\n  \\n  const plainText = rawContent\\n    .replace(/<[^>]*>/g, \\"\\")\\n    .replace(/\\\\s+/g, \\" \\")\\n    .trim();\\n    \\n  const safeText = JSON.stringify(plainText);\\n  \\n  // Get session from trigger headers\\n  const sessionCookie = data.$trigger?.headers?.cookie;\\n  const sessionId = data.$accountability?.session;\\n  \\n  // You can use the session to identify the real user\\n  // The session ID should correspond to the actual logged-in admin\\n  \\n  let userInfo = {\\n    language: null,\\n    session_id: sessionId,\\n    // For now, you might need to hardcode or use a lookup table\\n    // based on session or IP to identify the real admin user\\n  };\\n  \\n  return {\\n    plainText: safeText.slice(1, -1),\\n    id,\\n    course_id,\\n    userInfo,\\n    debug_session: sessionId,\\n    debug_ip: data.$accountability?.ip\\n  };\\n};"}	0b7a2118-4fef-4218-8234-edc5fd338534	\N	cef55b59-2cdf-4bea-980a-69659bb196b1	2025-10-20 13:33:39.352+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
05c22b57-2fde-4710-b26e-34f0874876cc	Read Data	item_read_hyih4	item-read	37	1	{"permissions":"$trigger","emitEvents":false,"collection":"lms_courses","query":{"filter":{"id":{"_eq":"{{lesson_data.module.course}}"}},"fields":["id","title","description"]}}	5bdbe60b-ab6f-447b-9c7c-a93bc6c6a8be	\N	cef55b59-2cdf-4bea-980a-69659bb196b1	2025-10-20 13:33:39.369+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
8f02b5bf-047f-4f75-8b7d-b81a955da6ae	Read Data	get_session_user	item-read	19	1	{"permissions":"$full","emitEvents":false,"collection":"directus_sessions","query":{"token":{"_eq":"{{$accountability.session}}"}},"key":[]}	098cc770-9529-48c3-a598-b4465e626b5c	\N	b45e5291-3f3d-44b9-bb0f-9a4a7572f56c	2025-07-24 10:24:16.556+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
a0db1c04-285a-4db9-a77a-b8db51c36292	Trigger Flow	trigger_1r7w6	trigger	73	1	{"iterationMode":"parallel","flow":"dc81ff24-171f-4531-a96f-9391f6df2224","payload":"{{ exec_8pzlj.parsedAssignment }}"}	\N	\N	d3c0c6d8-17f5-4098-8d55-ec00964eeff4	2025-07-02 15:52:31.579+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
1abe2510-7847-43e7-ab30-fb62cf4f4706	Create Data	item_create_p2n1p	item-create	19	1	{"permissions":"$trigger","emitEvents":false,"collection":"lms_assignement","payload":{"title":"{{ $trigger.title }}","description":"{{ $trigger.description }}","lesson":"{{ $trigger.lesson }}","instructions":"{{ $trigger.instructions }}"}}	\N	\N	dc81ff24-171f-4531-a96f-9391f6df2224	2025-07-02 15:51:13.411+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
9f77cfa8-3f3e-4c1b-80ea-e780ed13d2e9	Run Script	exec_8pzlj	exec	55	1	{"code":"module.exports = async function(data) {\\n\\treturn {\\n\\t\\tparsedAssignment: JSON.parse(data.$last.data.choices[0].message.content)\\n\\t};\\n}"}	a0db1c04-285a-4db9-a77a-b8db51c36292	\N	d3c0c6d8-17f5-4098-8d55-ec00964eeff4	2025-07-02 15:50:00.909+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
098cc770-9529-48c3-a598-b4465e626b5c	Read Data	get_real_user	item-read	4	22	{"permissions":"$full","emitEvents":false,"collection":"directus_users","query":{"id":{"_eq":"{{get_session_user[0].user}}"}}}	1a311a04-c013-46a6-b385-843b1058e2b0	\N	b45e5291-3f3d-44b9-bb0f-9a4a7572f56c	2025-07-24 10:24:16.485+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
6dad23dd-e95c-4b75-9e33-ccd6b3b51047	Read Data	item_read_yh59r	item-read	19	1	{"permissions":"$trigger","emitEvents":false,"collection":"lms_lessons","key":["{{$trigger.body.keys[0]}}"]}	19b5b25d-f550-4fd1-94e7-6eaad614bbb7	\N	d3c0c6d8-17f5-4098-8d55-ec00964eeff4	2025-07-02 15:50:00.938+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
48a5a9d0-1362-4657-a8be-fa52bd604787	Read Data	modules_data	item-read	20	1	{"permissions":"$full","emitEvents":false,"collection":"lms_modules","key":["{{$trigger.body.keys[0]}}"]}	9dbf2043-3754-4c44-b4ad-e41218e89072	\N	cd5a46f5-91ac-4d3f-802f-0df1c84e902e	2025-06-30 14:48:16.756+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
9749bbef-befe-4b86-88ee-72acf8f5e1b8	Run Script	exec_wlknm	exec	43	22	{"code":"module.exports = async function (data) {\\n  // Get session data (it's an array)\\n  const sessions = data.get_session_user || [];\\n  \\n  // Find the session that matches our current session token\\n  const currentSessionToken = data.$accountability?.session;\\n  const currentSession = sessions.find(session => session.token === currentSessionToken);\\n  \\n  // Get user ID from the matching session\\n  const userId = currentSession?.user;\\n  \\n  // Now get the user data\\n  const allUsers = data.get_real_user || [];\\n  const realUser = allUsers.find(user => user.id === userId) || allUsers[0];\\n  \\n  const userInfo = {\\n \\tlanguage: realUser?.language || \\"en-US\\",\\n    user_id: realUser?.id || null,\\n    name: realUser?.first_name || null,\\n    email: realUser?.email || null,\\n    debug_session_token: currentSessionToken,\\n    debug_found_user_id: userId\\n  };\\n  \\n  return {\\n    userInfo\\n  };\\n};"}	48a5a9d0-1362-4657-a8be-fa52bd604787	\N	cd5a46f5-91ac-4d3f-802f-0df1c84e902e	2025-07-25 14:34:36.683+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
126456e9-186c-4303-870a-7c96875e90bd	Read Data	get_real_user	item-read	23	21	{"permissions":"$full","emitEvents":false,"collection":"directus_users","query":{"id":{"_eq":"{{get_session_user[0].user}}"}}}	e7c210e7-5972-4f70-a22f-6a8f67374193	\N	d3c0c6d8-17f5-4098-8d55-ec00964eeff4	2025-07-25 14:39:27.521+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
8ee1a84e-e1a3-404f-a39e-1f3d371bcdda	Run Script	exec_wlknm	exec	43	22	{"code":"module.exports = async function (data) {\\n  // Get session data (it's an array)\\n  const sessions = data.get_session_user || [];\\n  \\n  // Find the session that matches our current session token\\n  const currentSessionToken = data.$accountability?.session;\\n  const currentSession = sessions.find(session => session.token === currentSessionToken);\\n  \\n  // Get user ID from the matching session\\n  const userId = currentSession?.user;\\n  \\n  // Now get the user data\\n  const allUsers = data.get_real_user || [];\\n  const realUser = allUsers.find(user => user.id === userId) || allUsers[0];\\n  \\n  const userInfo = {\\n \\tlanguage: realUser?.language || \\"en-US\\",\\n    user_id: realUser?.id || null,\\n    name: realUser?.first_name || null,\\n    email: realUser?.email || null,\\n    debug_session_token: currentSessionToken,\\n    debug_found_user_id: userId\\n  };\\n  \\n  return {\\n    userInfo\\n  };\\n};"}	04c8221a-f54e-4eac-bb8a-613ccd82350d	\N	0d2da200-cb38-4f3c-8181-80b03e4ecf20	2025-07-25 14:37:03.59+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
0b7a2118-4fef-4218-8234-edc5fd338534	Webhook / Request URL	request_at8r0	request	64	18	{"method":"POST","url":"http://rag-service:8000/generate-lesson-plan","headers":[{"header":"Content-Type","value":"application/json"}],"body":"{\\n  \\"lesson_id\\": \\"{{exec_r7alu.id}}\\",\\n  \\"lesson_title\\": \\"{{lesson_data.title}}\\",\\n  \\"lesson_content\\": \\"{{exec_r7alu.plainText}}\\",\\n  \\"module_title\\": \\"{{lesson_data.module.title}}\\",\\n  \\"course_title\\": \\"{{item_read_hyih4[0].title}}\\",\\n  \\"course_id\\": \\"{{exec_r7alu.course_id}}\\",\\n  \\"language\\": \\"{{exec_wlknm.userInfo.language}}\\"\\n}"}	5d3d0481-ef44-44f1-81f7-cf6dedd5601f	\N	cef55b59-2cdf-4bea-980a-69659bb196b1	2025-10-20 13:39:53.922+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
591fb3b8-466d-462b-a8e5-cb3c664ec011	Run Script	exec_wlknm	exec	43	22	{"code":"module.exports = async function (data) {\\n  // Get session data (it's an array)\\n  const sessions = data.get_session_user || [];\\n  \\n  // Find the session that matches our current session token\\n  const currentSessionToken = data.$accountability?.session;\\n  const currentSession = sessions.find(session => session.token === currentSessionToken);\\n  \\n  // Get user ID from the matching session\\n  const userId = currentSession?.user;\\n  \\n  // Now get the user data\\n  const allUsers = data.get_real_user || [];\\n  const realUser = allUsers.find(user => user.id === userId) || allUsers[0];\\n  \\n  const userInfo = {\\n \\tlanguage: realUser?.language || \\"en-US\\",\\n    user_id: realUser?.id || null,\\n    name: realUser?.first_name || null,\\n    email: realUser?.email || null,\\n    debug_session_token: currentSessionToken,\\n    debug_found_user_id: userId\\n  };\\n  \\n  return {\\n    userInfo\\n  };\\n};"}	deb5df6c-4655-43a3-8261-dad9e5d773fe	\N	cef55b59-2cdf-4bea-980a-69659bb196b1	2025-09-09 14:56:32.212+00	1fe1c7ff-37db-4f3d-a6ad-e50ea5cc60be
\.


--
-- PostgreSQL database dump complete
--

